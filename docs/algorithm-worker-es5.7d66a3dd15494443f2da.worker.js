!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function s(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,(function(e){return t[e]}).bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="DgrW")}({DgrW:function(e,r,s){"use strict";s.r(r),s.d(r,"extractInputgraph",function(){return F});var a=function(t){return t[t.unprocessed=0]="unprocessed",t[t.dangling=1]="dangling",t[t.processed=2]="processed",t}({});function c(t,e){return e.lineDegree-t.lineDegree}var d=function(){function t(e){u(this,t),this.indexMapping=new Map,this.content=[],this.comparator=e}return f(t,[{key:"push",value:function(t){this.content.push(t),this.indexMapping.set(t,this.content.length-1),this.siftUp(this.content.length-1)}},{key:"setPosition",value:function(t,e){this.content[e]=t,this.indexMapping.set(t,e)}},{key:"pop",value:function(){if(this.content.length<=1){var t=this.content.pop();return this.indexMapping.clear(),t}var e=this.content[0];return this.setPosition(this.content.pop(),0),this.siftDown(0),e}},{key:"update",value:function(t){var e=this.indexMapping.get(t);this.siftUp(e)}},{key:"has",value:function(t){return this.indexMapping.has(t)}},{key:"size",value:function(){return this.content.length}},{key:"parentIdx",value:function(t){return t-1>>1}},{key:"leftIdx",value:function(t){return 1+(t<<1)}},{key:"rightIdx",value:function(t){return 2+(t<<1)}},{key:"siftUp",value:function(t){for(var e=t;e>0;){var n=this.parentIdx(e);if(this.comparator(this.content[e],this.content[n])<=0)break;this.swap(e,n),e=n}}},{key:"siftDown",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;;){var e=this.leftIdx(t);if(e>=this.content.length)break;var n=this.rightIdx(t),r=n<this.content.length?this.comparator(this.content[e],this.content[n])>0?e:n:e;if(this.comparator(this.content[t],this.content[r])>=0)break;this.swap(r,t),t=r}}},{key:"swap",value:function(t,e){var n=this.content[t];this.setPosition(this.content[e],t),this.setPosition(n,e)}}]),t}(),h=function(){var t=function(){function t(){u(this,t)}return f(t,null,[{key:"fixIndex",value:function(t){return t<0&&(t+=8),t%8}}]),t}();return t.COST_SINK=2,t.COST_45=2,t.COST_90=1.5,t.COST_135=1,t.COST_180=0,t.TOP=0,t.TOP_RIGHT=1,t.RIGHT=2,t.BOTTOM_RIGHT=3,t.BOTTOM=4,t.BOTTOM_LEFT=5,t.LEFT=6,t.TOP_LEFT=7,t.SINK=8,t.COST_MOVE=.5,t.COST_HOP=6,t.COST_HOP_DIAGONAL=9,t.COST_CROSSING=20,t}(),l=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;u(this,t),this._edges=[],this._dist=1/0,this._priority=1/0,this._prev=this,this._gridNode=e,this._id=n,this._direction=r}return f(t,[{key:"id",get:function(){return this._id}},{key:"direction",get:function(){return this._direction}},{key:"edges",get:function(){return this._edges}},{key:"gridNode",get:function(){return this._gridNode}},{key:"dist",get:function(){return this._dist},set:function(t){this._dist=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"prev",get:function(){return this._prev},set:function(t){this._prev=t}},{key:"addEdge",value:function(t){this._edges.push(t)}},{key:"closeAllEdges",value:function(){this._edges.forEach(function(t){return t.weight=1/0})}},{key:"getEdge",value:function(t){for(var e=0;e<this.edges.length;e++){var n=this.edges[e];if(n.nodeA==t||n.nodeB==t)return n}}}]),t}(),p=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;u(this,t),this._used=!1,e.id<n.id?(this._nodeA=e,this._nodeB=n):(this._nodeA=n,this._nodeB=e),this._weight=r,this._originalWeight=r}return f(t,[{key:"nodeA",get:function(){return this._nodeA}},{key:"nodeB",get:function(){return this._nodeB}},{key:"weight",get:function(){return this._weight},set:function(t){this._weight=t}},{key:"used",get:function(){return this._used},set:function(t){this._used=t}},{key:"getNeighbourOf",value:function(t){if(t.id==this._nodeA.id)return this._nodeB;if(t.id==this._nodeB.id)return this._nodeA;throw new Error("Invalid node")}},{key:"resetWeight",value:function(){this.used||(this._weight=this._originalWeight)}}]),t}(),g=0,y=0,v=[];function _(t,e,n){var r=performance.now(),i=n.flatMap(function(t){return t.getOctiNode(h.SINK)});v.forEach(function(t){t.dist=1/0,t.priority=1/0,t.prev=t}),v=[];var o=new l(e[0],-1);e.map(function(t){return t.getOctiNode(h.SINK)}).forEach(function(t){return o.addEdge(new p(o,t,0))}),o.dist=0,o.priority=0;var s=performance.now(),a=new d(S);a.push(o);var u=0,c=function(){var t=a.pop();return t.dist==1/0?u>0?{v:(g+=performance.now()-r,m(o,i))}:"break":i.includes(t)&&(u++,i.length==u)?{v:(g+=performance.now()-r,m(o,i))}:void t.edges.forEach(function(e){var r=e.getNeighbourOf(t),i=t.dist+e.weight;i<r.dist&&(r.dist=i,r.priority=i+function(t,e){var n=1/0;return e.forEach(function(e){var r=function(t,e){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.max(n,r)}(t.gridNode,e)-1;r<n&&(n=r)}),h.COST_HOP*n}(r,n),r.prev=t,a.has(r)?a.update(r):(v.push(r),a.push(r)))})};for(y+=performance.now()-s;a.size()>0;){var f=c();if("break"===f)break;if("object"==typeof f)return f.v}return g+=performance.now()-r,[]}function S(t,e){return e.priority-t.priority}function m(t,e){for(var n=e.reduce(function(t,e){return t.dist<e.dist?t:e}),r=[n],i=n;i.prev!=t&&i.prev!=i;)i=i.prev,r.push(i);return r.reverse()}var k=function(t){return t[t.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",t[t.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",t[t.CLASS_TO_CLASS=2]="CLASS_TO_CLASS",t}({}),O=new(function(){function t(){u(this,t),this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return f(t,[{key:"addTypeMetadata",value:function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)}},{key:"addTransformMetadata",value:function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)}},{key:"addExposeMetadata",value:function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)}},{key:"addExcludeMetadata",value:function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)}},{key:"findTransformMetadatas",value:function(t,e,n){return this.findMetadatas(this._transformMetadatas,t,e).filter(function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?n===k.CLASS_TO_CLASS||n===k.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||n===k.CLASS_TO_PLAIN)})}},{key:"findExcludeMetadata",value:function(t,e){return this.findMetadata(this._excludeMetadatas,t,e)}},{key:"findExposeMetadata",value:function(t,e){return this.findMetadata(this._exposeMetadatas,t,e)}},{key:"findExposeMetadataByCustomName",value:function(t,e){return this.getExposedMetadatas(t).find(function(t){return t.options&&t.options.name===e})}},{key:"findTypeMetadata",value:function(t,e){return this.findMetadata(this._typeMetadatas,t,e)}},{key:"getStrategy",value:function(t){var e=this._excludeMetadatas.get(t),n=e&&e.get(void 0),r=this._exposeMetadatas.get(t),i=r&&r.get(void 0);return n&&i||!n&&!i?"none":n?"excludeAll":"exposeAll"}},{key:"getExposedMetadatas",value:function(t){return this.getMetadata(this._exposeMetadatas,t)}},{key:"getExcludedMetadatas",value:function(t){return this.getMetadata(this._excludeMetadatas,t)}},{key:"getExposedProperties",value:function(t,e){return this.getExposedMetadatas(t).filter(function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?e===k.CLASS_TO_CLASS||e===k.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||e===k.CLASS_TO_PLAIN)}).map(function(t){return t.propertyName})}},{key:"getExcludedProperties",value:function(t,e){return this.getExcludedMetadatas(t).filter(function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?e===k.CLASS_TO_CLASS||e===k.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||e===k.CLASS_TO_PLAIN)}).map(function(t){return t.propertyName})}},{key:"clear",value:function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()}},{key:"getMetadata",value:function(t,e){var n,r=t.get(e);r&&(n=Array.from(r.values()).filter(function(t){return void 0!==t.propertyName}));var s,a=[],u=o(this.getAncestors(e));try{for(u.s();!(s=u.n()).done;){var c=s.value,f=t.get(c);if(f){var d=Array.from(f.values()).filter(function(t){return void 0!==t.propertyName});a.push.apply(a,i(d))}}}catch(h){u.e(h)}finally{u.f()}return a.concat(n||[])}},{key:"findMetadata",value:function(t,e,n){var r=t.get(e);if(r){var i=r.get(n);if(i)return i}var s,a=o(this.getAncestors(e));try{for(a.s();!(s=a.n()).done;){var u=s.value,c=t.get(u);if(c){var f=c.get(n);if(f)return f}}}catch(d){a.e(d)}finally{a.f()}}},{key:"findMetadatas",value:function(t,e,n){var r,s=t.get(e);s&&(r=s.get(n));var a,u=[],c=o(this.getAncestors(e));try{for(c.s();!(a=c.n()).done;){var f=a.value,d=t.get(f);d&&d.has(n)&&u.push.apply(u,i(d.get(n)))}}catch(h){c.e(h)}finally{c.f()}return u.slice().reverse().concat((r||[]).slice().reverse())}},{key:"getAncestors",value:function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var e=[],n=Object.getPrototypeOf(t.prototype.constructor);void 0!==n.prototype;n=Object.getPrototypeOf(n.prototype.constructor))e.push(n);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)}}]),t}()),w=function(){function t(e,n){u(this,t),this.transformationType=e,this.options=n,this.recursionStack=new Set}return f(t,[{key:"transform",value:function(t,e,n,r,i){var s,a=this,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(Array.isArray(e)||e instanceof Set){var c=r&&this.transformationType===k.PLAIN_TO_CLASS?function(t){var e=new t;return e instanceof Set||"push"in e?e:[]}(r):[];return e.forEach(function(e,r){var i=t?t[r]:void 0;if(a.options.enableCircularCheck&&a.isCircular(e))a.transformationType===k.CLASS_TO_CLASS&&(c instanceof Set?c.add(e):c.push(e));else{var o;if("function"!=typeof n&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(a.transformationType===k.PLAIN_TO_CLASS){o=n.options.discriminator.subTypes.find(function(t){return t.name===e[n.options.discriminator.property]});var s=n.typeFunction({newObject:c,object:e,property:void 0});o=void 0===o?s:o.value,n.options.keepDiscriminatorProperty||delete e[n.options.discriminator.property]}a.transformationType===k.CLASS_TO_CLASS&&(o=e.constructor),a.transformationType===k.CLASS_TO_PLAIN&&(e[n.options.discriminator.property]=n.options.discriminator.subTypes.find(function(t){return t.value===e.constructor}).name)}else o=n;var f=a.transform(i,e,o,void 0,e instanceof Map,u+1);c instanceof Set?c.add(f):c.push(f)}}),c}if(n!==String||i){if(n!==Number||i){if(n!==Boolean||i){if((n===Date||e instanceof Date)&&!i)return e instanceof Date?new Date(e.valueOf()):null==e?e:new Date(e);if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(n===Buffer||e instanceof Buffer)&&!i)return null==e?e:Buffer.from(e);if(null===(s=e)||"object"!=typeof s||"function"!=typeof s.then||i){if(i||null===e||"object"!=typeof e||"function"!=typeof e.then){if("object"==typeof e&&null!==e){n||e.constructor===Object||(n=e.constructor),!n&&t&&(n=t.constructor),this.options.enableCircularCheck&&this.recursionStack.add(e);var f=this.getKeys(n,e,i),d=t||{};t||this.transformationType!==k.PLAIN_TO_CLASS&&this.transformationType!==k.CLASS_TO_CLASS||(d=i?new Map:n?new n:{});var h,l=o(f);try{var p=function(){var r=h.value;if("__proto__"===r||"constructor"===r)return"continue";var o=r,s=void 0,c=r,f=r;if(!a.options.ignoreDecorators&&n)if(a.transformationType===k.PLAIN_TO_CLASS){var l=O.findExposeMetadataByCustomName(n,r);l&&(f=l.propertyName,c=l.propertyName)}else if(a.transformationType===k.CLASS_TO_PLAIN||a.transformationType===k.CLASS_TO_CLASS){var p=O.findExposeMetadata(n,r);p&&p.options&&p.options.name&&(c=p.options.name)}s=e instanceof Map?e.get(o):e[o]instanceof Function?e[o]():e[o];var g=void 0,y=s instanceof Map;if(n&&i)g=n;else if(n){var v=O.findTypeMetadata(n,f);if(v){var _={newObject:d,object:e,property:f},S=v.typeFunction?v.typeFunction(_):v.reflectedType;v.options&&v.options.discriminator&&v.options.discriminator.property&&v.options.discriminator.subTypes?e[o]instanceof Array?g=v:(a.transformationType===k.PLAIN_TO_CLASS&&(g=void 0===(g=v.options.discriminator.subTypes.find(function(t){if(s&&s instanceof Object&&v.options.discriminator.property in s)return t.name===s[v.options.discriminator.property]}))?S:g.value,v.options.keepDiscriminatorProperty||s&&s instanceof Object&&v.options.discriminator.property in s&&delete s[v.options.discriminator.property]),a.transformationType===k.CLASS_TO_CLASS&&(g=s.constructor),a.transformationType===k.CLASS_TO_PLAIN&&(s[v.options.discriminator.property]=v.options.discriminator.subTypes.find(function(t){return t.value===s.constructor}).name)):g=S,y=y||v.reflectedType===Map}else if(a.options.targetMaps)a.options.targetMaps.filter(function(t){return t.target===n&&!!t.properties[f]}).forEach(function(t){return g=t.properties[f]});else if(a.options.enableImplicitConversion&&a.transformationType===k.PLAIN_TO_CLASS){var m=Reflect.getMetadata("design:type",n.prototype,f);m&&(g=m)}}var w=Array.isArray(e[o])?a.getReflectedType(n,f):void 0,N=t?t[o]:void 0;if(d.constructor.prototype){var T=Object.getOwnPropertyDescriptor(d.constructor.prototype,c);if((a.transformationType===k.PLAIN_TO_CLASS||a.transformationType===k.CLASS_TO_CLASS)&&(T&&!T.set||d[c]instanceof Function))return"continue"}if(a.options.enableCircularCheck&&a.isCircular(s)){if(a.transformationType===k.CLASS_TO_CLASS){var I=s;(void 0!==(I=a.applyCustomTransformations(I,n,r,e,a.transformationType))||a.options.exposeUnsetFields)&&(d instanceof Map?d.set(c,I):d[c]=I)}}else{var b,A=a.transformationType===k.PLAIN_TO_CLASS?c:r;a.transformationType===k.CLASS_TO_PLAIN?(b=e[A],b=a.applyCustomTransformations(b,n,A,e,a.transformationType),b=e[A]===b?s:b,b=a.transform(N,b,g,w,y,u+1)):void 0===s&&a.options.exposeDefaultValues?b=d[c]:(b=a.transform(N,s,g,w,y,u+1),b=a.applyCustomTransformations(b,n,A,e,a.transformationType)),(void 0!==b||a.options.exposeUnsetFields)&&(d instanceof Map?d.set(c,b):d[c]=b)}};for(l.s();!(h=l.n()).done;)p()}catch(g){l.e(g)}finally{l.f()}return this.options.enableCircularCheck&&this.recursionStack.delete(e),d}return e}return e}return new Promise(function(t,r){e.then(function(e){return t(a.transform(void 0,e,n,void 0,void 0,u+1))},r)})}return null==e?e:Boolean(e)}return null==e?e:Number(e)}return null==e?e:String(e)}},{key:"applyCustomTransformations",value:function(t,e,n,r,i){var o=this,s=O.findTransformMetadatas(e,n,this.transformationType);return void 0!==this.options.version&&(s=s.filter(function(t){return!t.options||o.checkVersion(t.options.since,t.options.until)})),(s=s.filter(this.options.groups&&this.options.groups.length?function(t){return!t.options||o.checkGroups(t.options.groups)}:function(t){return!t.options||!t.options.groups||!t.options.groups.length})).forEach(function(e){t=e.transformFn({value:t,key:n,obj:r,type:i,options:o.options})}),t}},{key:"isCircular",value:function(t){return this.recursionStack.has(t)}},{key:"getReflectedType",value:function(t,e){if(t){var n=O.findTypeMetadata(t,e);return n?n.reflectedType:void 0}}},{key:"getKeys",value:function(t,e,n){var r=this,i=O.getStrategy(t);"none"===i&&(i=this.options.strategy||"exposeAll");var o=[];if(("exposeAll"===i||n)&&(o=e instanceof Map?Array.from(e.keys()):Object.keys(e)),n)return o;if(!this.options.ignoreDecorators&&t){var s=O.getExposedProperties(t,this.transformationType);this.transformationType===k.PLAIN_TO_CLASS&&(s=s.map(function(e){var n=O.findExposeMetadata(t,e);return n&&n.options&&n.options.name?n.options.name:e})),o=this.options.excludeExtraneousValues?s:o.concat(s);var a=O.getExcludedProperties(t,this.transformationType);a.length>0&&(o=o.filter(function(t){return!a.includes(t)})),void 0!==this.options.version&&(o=o.filter(function(e){var n=O.findExposeMetadata(t,e);return!n||!n.options||r.checkVersion(n.options.since,n.options.until)})),o=o.filter(this.options.groups&&this.options.groups.length?function(e){var n=O.findExposeMetadata(t,e);return!n||!n.options||r.checkGroups(n.options.groups)}:function(e){var n=O.findExposeMetadata(t,e);return!(n&&n.options&&n.options.groups&&n.options.groups.length)})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(o=o.filter(function(t){return r.options.excludePrefixes.every(function(e){return t.substr(0,e.length)!==e})})),o=o.filter(function(t,e,n){return n.indexOf(t)===e})}},{key:"checkVersion",value:function(t,e){var n=!0;return n&&t&&(n=this.options.version>=t),n&&e&&(n=this.options.version<e),n}},{key:"checkGroups",value:function(t){return!t||this.options.groups.some(function(e){return t.includes(e)})}}]),t}(),N={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},T=new(function(){function t(){u(this,t)}return f(t,[{key:"classToPlain",value:function(t,e){return new w(k.CLASS_TO_PLAIN,n(n({},N),e)).transform(void 0,t,void 0,void 0,void 0,void 0)}},{key:"classToPlainFromExist",value:function(t,e,r){return new w(k.CLASS_TO_PLAIN,n(n({},N),r)).transform(e,t,void 0,void 0,void 0,void 0)}},{key:"plainToClass",value:function(t,e,r){return new w(k.PLAIN_TO_CLASS,n(n({},N),r)).transform(void 0,e,t,void 0,void 0,void 0)}},{key:"plainToClassFromExist",value:function(t,e,r){return new w(k.PLAIN_TO_CLASS,n(n({},N),r)).transform(t,e,void 0,void 0,void 0,void 0)}},{key:"classToClass",value:function(t,e){return new w(k.CLASS_TO_CLASS,n(n({},N),e)).transform(void 0,t,void 0,void 0,void 0,void 0)}},{key:"classToClassFromExist",value:function(t,e,r){return new w(k.CLASS_TO_CLASS,n(n({},N),r)).transform(e,t,void 0,void 0,void 0,void 0)}},{key:"serialize",value:function(t,e){return JSON.stringify(this.classToPlain(t,e))}},{key:"deserialize",value:function(t,e,n){var r=JSON.parse(e);return this.plainToClass(t,r,n)}},{key:"deserializeArray",value:function(t,e,n){var r=JSON.parse(e);return this.plainToClass(t,r,n)}}]),t}());function I(t,e,n){return T.plainToClass(t,e,n)}var b=function(){function t(e,n,r){u(this,t),this._to=e,this._direction=n,this._edge=r}return f(t,[{key:"to",get:function(){return this._to}},{key:"direction",get:function(){return this._direction}},{key:"edge",get:function(){return this._edge}}]),t}(),A=function(){function t(e,n,r){u(this,t),this._routedEdges=[],this._station=void 0,this._id=e,this._x=n,this._y=r,this._octiNodes=new Array(9);for(var i=0;i<9;i++)this._octiNodes[i]=new l(this,this._id+1+i,i);for(var o=0;o<8;o++)for(var s=o+1;s<8;s++){var a=this._octiNodes[o],c=this._octiNodes[s],f=new p(a,c,this.calculateWeight(o,s));a.addEdge(f),c.addEdge(f)}for(var d=0;d<8;d++){var g=this._octiNodes[d],y=this._octiNodes[h.SINK],v=new p(g,y,h.COST_SINK);g.addEdge(v),y.addEdge(v)}}return f(t,[{key:"id",get:function(){return this._id}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"octiNodes",get:function(){return this._octiNodes}},{key:"routedEdges",get:function(){return this._routedEdges}},{key:"station",get:function(){return this._station},set:function(t){this._station=t}},{key:"getCoordinates",value:function(){return[this._x,this._y]}},{key:"getOctiNode",value:function(t){return this._octiNodes[t]}},{key:"closeSinkEdge",value:function(){this.getOctiNode(h.SINK).closeAllEdges()}},{key:"closeBendEdges",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,e=0;e<8;e++)for(var n=this.getOctiNode(e),r=0;r<7;r++)n.edges[r].weight=t}},{key:"reopenSinkEdges",value:function(){this.getOctiNode(h.SINK).edges.filter(function(t){return!t.used}).forEach(function(t){return t.weight=h.COST_SINK})}},{key:"reopenBendEdges",value:function(){for(var t=0;t<8;t++)for(var e=this.getOctiNode(t),n=0;n<7;n++)e.edges[n].resetWeight()}},{key:"saveRouting",value:function(t,e,n){this._routedEdges.push(new b(t,e,n))}},{key:"removeRouting",value:function(t){this._routedEdges=this._routedEdges.filter(function(e){return e.edge!=t})}},{key:"blockForCircularOrdering",value:function(t){var e=this;if(null!=this._station&&!(this._station.adjacentNodes.size<=2)){for(var n=this._station.edgeOrdering.length,r=this._station.edgeOrdering.findIndex(function(e){return e==t}),i=0,o=0,s=0,a=function(t){var r=e._station.edgeOrdering[t%n],i=e._routedEdges.find(function(t){return t.edge==r});if(null!=i)return o=h.fixIndex(i.direction-s),"break";s++},u=r+1;u<r+n;u++){if("break"===a(u))break}s=0;for(var c=function(t){var r=e._station.edgeOrdering[(t+n)%n],o=e._routedEdges.find(function(t){return t.edge==r});if(null!=o)return i=h.fixIndex(o.direction+s),"break";s++},f=r-1;f>r-n;f--){if("break"===c(f))break}this.closeEdgesBetweenIndices(o,i)}}},{key:"closeEdgesBetweenIndices",value:function(t,e){var n=h.fixIndex(t);for(n%=8;n!=e;)this.octiNodes[h.SINK].edges[n].weight=1/0,n+=1,n=h.fixIndex(n);this.octiNodes[h.SINK].edges[n].weight=1/0}},{key:"addLineBendPenalty",value:function(){var t=this;this.getOctiNode(h.SINK).edges.forEach(function(e,n){if(e.weight!=1/0){var r=0;t._routedEdges.forEach(function(e){r+=t.calculateWeight(n,e.direction)}),e.weight=r}})}},{key:"calculateWeight",value:function(t,e){if(t==h.SINK||e==h.SINK)return h.COST_SINK;var n=this.calculateOctiAngle(t,e);switch(n){case 1:return h.COST_45;case 2:return h.COST_90;case 3:return h.COST_135;case 4:return h.COST_180;default:throw new Error("Invalid angle: "+n)}}},{key:"calculateOctiAngle",value:function(t,e){var n=t-e;return n<-4?n+=8:n>4&&(n-=8),Math.abs(n)}}]),t}(),E=function(){function e(t,n){u(this,e),this._gridNodes=[],this._width=t,this._height=n;for(var r=0,i=0;i<t;i++){this._gridNodes[i]=[];for(var s=0;s<n;s++)this._gridNodes[i][s]=new A(r,i,s),r+=10}for(var a=[{x:0,y:1,portIndex:h.TOP},{x:1,y:1,portIndex:h.TOP_RIGHT},{x:1,y:0,portIndex:h.RIGHT},{x:1,y:-1,portIndex:h.BOTTOM_RIGHT}],c=0;c<t;c++)for(var f=0;f<n;f++){var d,l=this._gridNodes[c][f],g=o(a);try{for(g.s();!(d=g.n()).done;){var y=d.value,v=c+y.x,_=f+y.y;if(!(v<0||v>=t)&&!(_<0||_>=n)){var S=l.getOctiNode(y.portIndex),m=this._gridNodes[v][_].getOctiNode(y.portIndex+4),k=Math.abs(y.x)+Math.abs(y.y)==2,O=new p(S,m,k?h.COST_HOP_DIAGONAL:h.COST_HOP);S.addEdge(O),m.addEdge(O)}}}catch(w){g.e(w)}finally{g.f()}}}return f(e,[{key:"gridNodes",get:function(){return this._gridNodes}},{key:"allNodes",get:function(){return this.gridNodes.flatMap(function(t){return t.flatMap(function(t){return t.octiNodes})})}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"hasNode",value:function(t,e){return!(t<0||t>=this._width||e<0||e>=this._height)}},{key:"getNode",value:function(t,e){return this._gridNodes[t][e]}},{key:"getDiagonal",value:function(e){var n=e.nodeA,r=e.nodeB;if(n.gridNode!=r.gridNode){var i=t(n.gridNode.getCoordinates(),2),o=i[0],s=i[1],a=t(r.gridNode.getCoordinates(),2),u=a[0],c=a[1];if(1==Math.abs(o-u)&&1==Math.abs(s-c)){var f,d,h=this.getNode(o,c),l=this.getNode(u,s),p=t(h.getCoordinates(),2),g=p[0],y=p[1],v=t(l.getCoordinates(),2),_=v[0],S=v[1];return g>_&&y>S?(f=h.getOctiNode(5),d=l.getOctiNode(1)):g<_&&y<S?(f=h.getOctiNode(1),d=l.getOctiNode(5)):g<_&&S<y?(f=h.getOctiNode(3),d=l.getOctiNode(7)):(f=h.getOctiNode(7),d=l.getOctiNode(3)),f.getEdge(d)}}}},{key:"closeDiagonalEdge",value:function(t,e){var n=this.getDiagonal(t);null!=n&&(n.weight=e?h.COST_CROSSING:1/0)}}]),e}(),M=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;u(this,t),this.x=e,this.y=n},x=function(){function t(){u(this,t),this._latitude=0,this._longitude=0,this._stationName="",this._stopID="",this._lineDegree=0,this._status=a.unprocessed,this._adjacentNodes=new Set,this._edgeOrdering=[]}return f(t,[{key:"latitude",get:function(){return this._latitude},set:function(t){this._latitude=t}},{key:"longitude",get:function(){return this._longitude},set:function(t){this._longitude=t}},{key:"stationName",get:function(){return this._stationName},set:function(t){this._stationName=t}},{key:"stopID",get:function(){return this._stopID},set:function(t){this._stopID=t}},{key:"lineDegree",get:function(){return this._lineDegree},set:function(t){this._lineDegree=t}},{key:"status",get:function(){return this._status},set:function(t){this._status=t}},{key:"adjacentNodes",get:function(){return this._adjacentNodes},set:function(t){this._adjacentNodes=t}},{key:"edgeOrdering",get:function(){return this._edgeOrdering}},{key:"raiseLineDegreeBy",value:function(t){this._lineDegree+=t}},{key:"calculateEdgeOrdering",value:function(t,e){var n=this,r=[0,1];this._edgeOrdering=Array.from(t.values()).map(function(t){var e,i,o,s=t.otherStation(n);return{adjacentNode:s,angle:(e=r,i=[s.latitude-n.latitude,s.longitude-n.longitude],o=-1*(Math.atan2(i[1],i[0])-Math.atan2(e[1],e[0]))*(180/Math.PI),o<0&&(o=360+o),o),adjacentEdge:t}}).sort(function(t,e){return e.angle-t.angle}).map(function(t){return t.adjacentEdge})}},{key:"replaceStation",value:function(t,e,n){for(var r=Array.from(this.adjacentNodes),i=0;i<this.adjacentNodes.size;i++)if(r[i].stopID==t){r[i]=e;break}for(var o=0;o<this._edgeOrdering.length;o++)if(this._edgeOrdering[o].otherStation(this).stopID==t){this._edgeOrdering[o]=n;break}this.adjacentNodes=new Set(r)}}]),t}(),C=function(){function t(e,n,r,i,o){u(this,t),this._line=[],this._inBetweenStations=[],this._color=[],this._routeType="",this._line.push(e),this._station1=n,this._station2=r,this._color.push(null==i||i.length<6?"#000000":i),this._routeType=o}return f(t,[{key:"station1",get:function(){return this._station1},set:function(t){this._station1=t}},{key:"station2",get:function(){return this._station2},set:function(t){this._station2=t}},{key:"line",get:function(){return this._line}},{key:"inBetweenStations",get:function(){return this._inBetweenStations},set:function(t){this._inBetweenStations=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"routeType",get:function(){return this._routeType}},{key:"getLineDegree",value:function(){return this._line.length}},{key:"equalsByStation",value:function(t){return this.station2.stopID==t.station2.stopID&&this.station1.stopID==t.station1.stopID||this.station1.stopID==t.station2.stopID&&this.station2.stopID==t.station1.stopID}},{key:"addLine",value:function(t,e){var n,r;(n=this._line).push.apply(n,i(t)),(r=this._color).push.apply(r,i(e))}},{key:"otherStation",value:function(t){return this.station1==t?this.station2:this.station1}}]),t}();function D(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function P(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n,r){var i=Reflect.getMetadata("design:type",n,r);O.addTypeMetadata({target:n.constructor,propertyName:r,reflectedType:i,typeFunction:t,options:e})}}s("mNvP");var L,j,B=(L=function(){function t(){u(this,t),this._nodes=[],this._edges=[]}return f(t,[{key:"nodes",get:function(){return this._nodes},set:function(t){this._nodes=t}},{key:"edges",get:function(){return this._edges},set:function(t){this._edges=t}},{key:"getMinCoordinates",value:function(){var t=1/0,e=1/0;return this.nodes.forEach(function(n){n.longitude<t&&(t=n.longitude),n.latitude<e&&(e=n.latitude)}),[t,e]}},{key:"getDimensions",value:function(){var t=1/0,e=1/0,n=-1/0,r=-1/0;return this.nodes.forEach(function(i){i.longitude<t&&(t=i.longitude),i.longitude>n&&(n=i.longitude),i.latitude<e&&(e=i.latitude),i.latitude>r&&(r=i.latitude)}),[n-t,r-e]}},{key:"getNodesByStatus",value:function(t){return this.nodes.filter(function(e){return e.status==t})}},{key:"getNodeIDsByStatus",value:function(t){return this.getNodesByStatus(t).map(function(t){return t.stopID})}},{key:"getNodeByID",value:function(t){return this._nodes.find(function(e){return e.stopID==t})}},{key:"getAllNotProcessedNodesIDs",value:function(){return this.getNodeIDsByStatus(a.unprocessed).concat(this.getNodeIDsByStatus(a.dangling))}},{key:"setNodeAsProcessed",value:function(t){var e=this.getNodeByID(t);null!=e&&(e.status=a.processed)}},{key:"calculateNodeLineDegrees",value:function(){var t=this;this.edges.forEach(function(e){var n=e.station1.stopID,r=e.station2.stopID,i=t.nodes.find(function(t){return t.stopID==n});void 0!==i&&i.raiseLineDegreeBy(e.getLineDegree()),void 0!==(i=t.nodes.find(function(t){return t.stopID==r}))&&i.raiseLineDegreeBy(e.getLineDegree())})}},{key:"getDanglingNodeWithHighestDegree",value:function(){for(var t=-1,e=-1,n=this.getNodesByStatus(a.dangling),r=0;r<n.length;r++){var i=this.getNodeByID(n[r].stopID);void 0!==i&&i.lineDegree>t&&(t=i.lineDegree,e=r)}return n[e].stopID}},{key:"getIncidentEdges",value:function(t){var e=[];return this.edges.forEach(function(n){n.station2.stopID!==t&&n.station1.stopID!==t||e.push(n)}),e}},{key:"getAdjacentNodes",value:function(t){var e=[];return this.edges.forEach(function(n){n.station2.stopID===t?e.push(n.station1.stopID):n.station1.stopID===t&&e.push(n.station2.stopID)}),this.nodes.filter(function(t){return-1!=e.indexOf(t.stopID)})}},{key:"calculateEdgeOrderingAtNode",value:function(){var t=this;this.nodes.forEach(function(e){var n=new Set,r=new Set;t.edges.forEach(function(i){i.station1.stopID==e.stopID?(n.add(i),r.add(t.getNodeByID(i.station2.stopID))):i.station2.stopID==e.stopID&&(n.add(i),r.add(t.getNodeByID(i.station1.stopID)))}),0!=r.size&&0!=n.size&&(e.calculateEdgeOrdering(n,r),e.adjacentNodes=r)})}},{key:"removeTwoDegreeNodes",value:function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(2==e.adjacentNodes.size)for(var n=void 0,r=Array.from(e.adjacentNodes),o=!1,s=0;s<this.edges.length;s++){var a=this.edges[s];if(o||a.station2.stopID!=e.stopID&&a.station1.stopID!=e.stopID||(n=a,a.station2.stopID==e.stopID?(a.inBetweenStations.push(a.station2),a.station2=a.station1.stopID==r[0].stopID?r[1]:r[0]):(a.inBetweenStations.push(a.station1),a.station1=a.station2.stopID==r[0].stopID?r[1]:r[0]),r[0].replaceStation(e.stopID,r[1],n),r[1].replaceStation(e.stopID,r[0],n),o=!0),(a.station1.stopID==e.stopID||a.station2.stopID==e.stopID)&&o){var u;(u=n.inBetweenStations).push.apply(u,i(this.edges[s].inBetweenStations)),this.edges.splice(s,1);break}}}}},{key:"removeNodesWithoutEdges",value:function(){for(var t=0;t<this.nodes.length;t++)0==this.nodes[t].adjacentNodes.size&&(this.nodes.splice(t,1),t--)}},{key:"mergeEqualEdges",value:function(){for(var t=[],e=0;e<this._edges.length;e++){var n=this._edges[e],r=this.containsEdge(t,n);null!=r?r.addLine(n.line,n.color):t.push(n)}this._edges=t}},{key:"containsEdge",value:function(t,e){for(var n=0;n<t.length;n++)if(t[n].equalsByStation(e))return t[n]}}]),t}(),D([P(function(){return x})],L.prototype,"_nodes",void 0),D([P(function(){return C})],L.prototype,"_edges",void 0),L),G=function(){function t(e,n,r,i){u(this,t),this._inBetweenStations=[],this._points=e,this._lines=n,this._inBetweenStations=null==r?void 0:r.map(function(t){return t.stationName}),this._color=i}return f(t,[{key:"points",get:function(){return this._points}},{key:"lines",get:function(){return this._lines}},{key:"inBetweenStations",get:function(){return this._inBetweenStations}},{key:"colors",get:function(){return this._color}}]),t}(),R=function(){function t(e,n){u(this,t),this._position=e,this._name=n}return f(t,[{key:"position",get:function(){return this._position}},{key:"name",get:function(){return this._name}}]),t}(),K=(j=function(){function t(e,n,r,i){u(this,t),this._paths=[],this._width=e,this._height=n,this._paths=i,this._stations=r}return f(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"stations",get:function(){return this._stations}},{key:"paths",get:function(){return this._paths}}]),t}(),D([P(function(){return R})],j.prototype,"_stations",void 0),D([P(function(){return G})],j.prototype,"_paths",void 0),j);function F(t){var e=I(B,t);return e.nodes=e.nodes.map(function(t){return I(x,t)}),e.edges=e.edges.map(function(t){return I(C,t)}),e.edges.forEach(function(t){var n=t.station2._stopID;t.station2=e.getNodeByID(t.station1._stopID),t.station1=e.getNodeByID(n)}),e}addEventListener("message",function(t){var e=t.data;if(null!=e.graph){console.log("[algorithm-worker] preparing");var n=F(e.graph),r=new z(n,e);console.log("[algorithm-worker] starting algorithm");var i=r.performAlgorithm(function(t){t.nodes.sort(c);var e=[];return t.getNodesByStatus(a.unprocessed).forEach(function(n){n.status=a.dangling;for(var r=t.getNodesByStatus(a.dangling);0!=r.length;){var i=t.getDanglingNodeWithHighestDegree(),o=t.getIncidentEdges(i),s=t.getAdjacentNodes(i);s.sort(c);for(var u=[];0!=s.length;){var f=s[0];if(-1!==t.getAllNotProcessedNodesIDs().indexOf(f.stopID))for(var d=0;d<o.length;d++){var h=o[d];h.station1.stopID!=f.stopID&&h.station2.stopID!=f.stopID||(u.push(h),o.splice(d,1),d--)}s.shift()}t.setNodeAsProcessed(i),e=e.concat(u),r=t.getNodesByStatus(a.dangling)}}),e}(n));console.log("[algorithm-worker] creating output graph"),console.log("[algorithm-worker] finished"),postMessage(i)}});var z=function(){function t(e,n){var r,i;u(this,t),this._ignoreError=!0,this._settledStations=new Map,this._foundPaths=new Map,this.allowCrossing=!1,this.exactString=[],this.exactString=n.exactString,this.allowCrossing=n.allowCrossing,(e=this.filterInputGraph(e)).mergeEqualEdges(),e.calculateNodeLineDegrees(),e.calculateEdgeOrderingAtNode(),e.removeNodesWithoutEdges(),this.D=(i=0,(r=e).edges.forEach(function(t){var e,n,r,o;i+=(e=t.station1,n=t.station2,r=Math.pow(e.latitude-n.latitude,2),o=Math.pow(e.longitude-n.longitude,2),Math.sqrt(r+o))}),i/r.edges.length*parseFloat(n.r)),e.removeTwoDegreeNodes(),e.calculateEdgeOrderingAtNode(),this.r=2,this._inputGraph=e;var o=e.getDimensions();this._graphOffset=e.getMinCoordinates(),this._octiGraph=new E(o[0]/this.D,o[1]/this.D)}return f(t,[{key:"performAlgorithm",value:function(t){var e=this;return this._foundPaths.clear(),this._settledStations.clear(),t.forEach(function(t){var n=t.station1,r=t.station2,i=e.getCandidateNodes(n,r),o=i[0],s=i[1];e.isSettled(o)&&(o[0].blockForCircularOrdering(t),o[0].addLineBendPenalty()),e.isSettled(s)&&(s[0].blockForCircularOrdering(t),s[0].addLineBendPenalty());var a=_(0,o,s);if(0==a.length&&e._ignoreError)console.log("[algorithm-worker] No path found for edge: (".concat(n.stationName," - ").concat(r.stationName,")"));else{if(0==a.length)throw new Error("No path found for edge: (".concat(n.stationName," - ").concat(r.stationName,")"));e.storePath(a,t,n,r)}}),console.log("Total time in dijkstra:",g,"section time:",y),console.log("[algorithm-worker] starting local search"),g=0,y=0,Array.from(this._settledStations.keys()).forEach(function(t){e.performLocalSearch(t)}),console.log("Total time in dijkstra:",g,"section time:",y),console.log("Found ".concat(this._foundPaths.size," of ").concat(this._inputGraph.edges.length)),this._inputGraph.edges.forEach(function(t){e._foundPaths.has(t)||console.log("Did not find ",t)}),this.createOutputGraph()}},{key:"isSettled",value:function(t){return 1==t.length&&Array.from(this._settledStations.values()).includes(t[0])}},{key:"getCandidateNodes",value:function(t,e){for(var n=this.getGrapCoordinates(t),r=this.getGrapCoordinates(e),i=[],o=[],s=-this.r-1;s<=this.r+1;s++)for(var a=-this.r-1;a<=this.r+1;a++)for(var u=0,c=[n,r];u<c.length;u++){var f=c[u],d=Math.round(f.x+s),l=Math.round(f.y+a);if(!this._octiGraph.hasNode(d,l))break;var p=this._octiGraph.getNode(d,l);if(!i.includes(p)&&!o.includes(p)&&(!Array.from(this._settledStations.values()).includes(p)&&!this.nodeIsUsed(p))){var g=Math.sqrt((n.x-d)*(n.x-d)+(n.y-l)*(n.y-l)),y=Math.sqrt((r.x-d)*(r.x-d)+(r.y-l)*(r.y-l));(g<=this.r||y<=this.r)&&(g<y?function(){var t=g*(h.COST_MOVE+h.COST_HOP);p.getOctiNode(h.SINK).edges.forEach(function(e){return e.weight=h.COST_SINK+t}),i.push(p)}():function(){var t=y*(h.COST_MOVE+h.COST_HOP);p.getOctiNode(h.SINK).edges.forEach(function(e){return e.weight=h.COST_SINK+t}),o.push(p)}())}}if(this._settledStations.has(t)){var v=this._settledStations.get(t);v.reopenSinkEdges(),i=[v]}if(this._settledStations.has(e)){var _=this._settledStations.get(e);_.reopenSinkEdges(),o=[_]}return[i,o]}},{key:"nodeIsUsed",value:function(t){return t.octiNodes.flatMap(function(t){return t.edges}).some(function(t){return t.used})}},{key:"filterInputGraph",value:function(t){var e=this;return 0!=this.exactString.length&&(t.edges=t.edges.filter(function(t){return e.exactString.some(function(e){return e===t.line[0]})})),t}},{key:"storePath",value:function(t,e,n,r){var i=this;this._foundPaths.set(e,t),this._settledStations.set(n,t[0].gridNode),this._settledStations.set(r,t[t.length-1].gridNode),t[0].gridNode.station=n,t[t.length-1].gridNode.station=r,t[0].gridNode.saveRouting(r,t[1].direction,e),t[t.length-1].gridNode.saveRouting(n,t[t.length-2].direction,e),t.map(function(t){return t.gridNode}).forEach(function(t){t.closeSinkEdge(),t.closeBendEdges(i.allowCrossing?h.COST_CROSSING:1/0)});for(var o=0;o<t.length-1;o++){var s=t[o].getEdge(t[o+1]);null!=s&&(s.used=!0,s.weight=1/0,this._octiGraph.closeDiagonalEdge(s,this.allowCrossing))}}},{key:"performLocalSearch",value:function(t){for(var e=this,n=this._settledStations.get(t),r=[],i=-1;i<=1;i++)for(var o=-1;o<=1;o++)if(this._octiGraph.hasNode(n.x+i,n.y+o)){var s=this._octiGraph.getNode(n.x+i,n.y+o);if(null==s.station&&(this.removeAllRoutingsTo(t),!this.nodeIsUsed(s))){var a=this.routeAllStationEdges(t,s);a.x=i,a.y=o,r.push(a)}}if(this.removeAllRoutingsTo(t),0!=r.length){var u=r.reduce(function(t,e){return t.found.size>e.found.size?t:t.found.size<e.found.size?e:t.cost<e.cost?t:e});u.found.size<t.edgeOrdering.length&&console.log("[algorithm-worker] Local search missing ".concat(t.edgeOrdering.length-u.found.size," edges for: ").concat(t.stationName)),u.found.forEach(function(n,r){return e.storePath(n,r,t,r.otherStation(t))})}else console.log("[algorithm-worker] Local search failed for: ".concat(t.stationName))}},{key:"removeAllRoutingsTo",value:function(t){var e=this;t.edgeOrdering.forEach(function(n){var r=e._foundPaths.get(n);null!=r&&(e.reopenPath(r),r.slice(2,r.length-3).forEach(function(t){t.gridNode.reopenSinkEdges(),t.gridNode.reopenBendEdges()}),r[0].gridNode.removeRouting(n),r[r.length-1].gridNode.removeRouting(n),r[0].gridNode.station==t&&(r[0].gridNode.station=void 0,r[0].gridNode.closeBendEdges(),r[0].gridNode.reopenSinkEdges()),r[r.length-1].gridNode.station==t&&(r[r.length-1].gridNode.station=void 0,r[r.length-1].gridNode.reopenBendEdges(),r[r.length-1].gridNode.reopenSinkEdges()),e._foundPaths.delete(n))}),this._settledStations.delete(t)}},{key:"routeAllStationEdges",value:function(t,e){var n=this,r=0,i=new Map;return t.edgeOrdering.forEach(function(o){var s=o.otherStation(t);if(n._settledStations.has(s)){var a=n._settledStations.get(s),u=n.routePath(e,a,t,s,o);0!=u.length&&(r+=u[u.length-1].dist,i.set(o,u))}}),{cost:r,found:i,x:0,y:0}}},{key:"routePath",value:function(t,e,n,r,i){t.reopenSinkEdges(),t.blockForCircularOrdering(i),t.addLineBendPenalty(),e.reopenSinkEdges(),e.blockForCircularOrdering(i),e.addLineBendPenalty();var o=_(0,[t],[e]);return 0==o.length?[]:(this.storePath(o,i,n,r),o)}},{key:"reopenPath",value:function(t){for(var e=0;e<t.length-1;e++){var n=t[e].getEdge(t[e+1]);if(null!=n){n.used=!1,n.resetWeight();var r=this._octiGraph.getDiagonal(n);null!=r&&r.resetWeight()}}}},{key:"getGrapCoordinates",value:function(t){return new M((t.longitude-this._graphOffset[0])/this.D,(t.latitude-this._graphOffset[1])/this.D)}},{key:"createOutputGraph",value:function(){var t=this,e=[];this._settledStations.forEach(function(t,n){e.push(new R(new M(t.x,t.y),n.stationName))});var n=[];return this._foundPaths.forEach(function(e,r){var o=i(new Set(e.map(function(t){return t.gridNode}))),s=o.map(function(t){return new M(t.x,t.y)}),a=r.station1;r.inBetweenStations=r.inBetweenStations.sort(function(e,n){var i=t.euclideanDistance([a.latitude,a.longitude],[e.latitude,e.longitude]),s=t.euclideanDistance([a.latitude,a.longitude],[n.latitude,n.longitude]);return o[0].station==r.station2?s-i:i-s}),n.push(new G(s,r.line,r.inBetweenStations,r.color))}),new K(this._octiGraph.width,this._octiGraph.height,e,n)}},{key:"euclideanDistance",value:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}}]),t}()},mNvP:function(t,e){var n;!function(t){!function(e){var n="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(t);function i(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===n.Reflect?n.Reflect=t:r=i(n.Reflect,r),function(t){var e=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!o&&!s,u={create:o?function(){return P(Object.create(null))}:s?function(){return P({__proto__:null})}:function(){return P({})},has:a?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:a?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),f="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,o)},e.prototype.entries=function(){return new n(this._keys,this._values,s)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function o(t,e){return e}function s(t,e){return[t,e]}}():Map,h=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,l=new(f||"function"!=typeof WeakMap?function(){var t=u.create(),n=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+s()}while(u.has(t,e));return t[e]=!0,e}function i(t,r){if(!e.call(t,n)){if(!r)return;Object.defineProperty(t,n,{value:u.create()})}return t[n]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function s(){var t="function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(16)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(16)):o(new Uint8Array(16),16):o(new Array(16),16);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var e="",n=0;n<16;++n){var r=t[n];4!==n&&6!==n&&8!==n||(e+="-"),r<16&&(e+="0"),e+=r.toString(16).toLowerCase()}return e}}():WeakMap);function p(t,e,n){var r=l.get(t);if(w(r)){if(!n)return;r=new d,l.set(t,r)}var i=r.get(e);if(w(i)){if(!n)return;i=new d,r.set(e,i)}return i}function g(t,e,n){if(y(t,e,n))return!0;var r=D(e);return!N(r)&&g(t,r,n)}function y(t,e,n){var r=p(e,n,!1);return!w(r)&&!!r.has(t)}function v(t,e,n){if(y(t,e,n))return _(t,e,n);var r=D(e);return N(r)?void 0:v(t,r,n)}function _(t,e,n){var r=p(e,n,!1);if(!w(r))return r.get(t)}function S(t,e,n,r){p(n,r,!0).set(t,e)}function m(t,e){var n=k(t,e),r=D(t);if(null===r)return n;var i=m(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new h,s=[],a=0,u=n;a<u.length;a++)o.has(d=u[a])||(o.add(d),s.push(d));for(var c=0,f=i;c<f.length;c++){var d;o.has(d=f[c])||(o.add(d),s.push(d))}return s}function k(t,e){var n=[],r=p(t,e,!1);if(w(r))return n;for(var o=function(t){var e=M(t,i);if(!A(e))throw new TypeError;var n=e.call(t);if(!T(n))throw new TypeError;return n}(r.keys()),s=0;;){var a=x(o);if(!a)return n.length=s,n;var u=a.value;try{n[s]=u}catch(c){try{C(o)}finally{throw c}}s++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function N(t){return null===t}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function I(t){var e=function(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n="string",i=M(t,r);if(void 0!==i){var o=i.call(t,n);if(T(o))throw new TypeError;return o}return function(t,e){var n,r,i=t.toString;if(A(i)&&!T(r=i.call(t)))return r;if(A(n=t.valueOf)&&!T(r=n.call(t)))return r;throw new TypeError}(t)}(t);return"symbol"==typeof e?e:function(t){return""+t}(e)}function b(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function A(t){return"function"==typeof t}function E(t){return"function"==typeof t}function M(t,e){var n=t[e];if(null!=n){if(!A(n))throw new TypeError;return n}}function x(t){var e=t.next();return!e.done&&e}function C(t){var e=t.return;e&&e.call(t)}function D(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function P(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,n,r){if(w(n)){if(!b(t))throw new TypeError;if(!E(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!w(r)&&!N(r)){if(!E(r))throw new TypeError;e=r}}return e}(t,e)}if(!b(t))throw new TypeError;if(!T(e))throw new TypeError;if(!T(r)&&!w(r)&&!N(r))throw new TypeError;return N(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!w(o)&&!N(o)){if(!T(o))throw new TypeError;r=o}}return r}(t,e,n=I(n),r)}),t("metadata",function(t,e){return function(n,r){if(!T(n))throw new TypeError;if(!w(r)&&!function(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;S(t,e,n,r)}}),t("defineMetadata",function(t,e,n,r){if(!T(n))throw new TypeError;return w(r)||(r=I(r)),S(t,e,n,r)}),t("hasMetadata",function(t,e,n){if(!T(e))throw new TypeError;return w(n)||(n=I(n)),g(t,e,n)}),t("hasOwnMetadata",function(t,e,n){if(!T(e))throw new TypeError;return w(n)||(n=I(n)),y(t,e,n)}),t("getMetadata",function(t,e,n){if(!T(e))throw new TypeError;return w(n)||(n=I(n)),v(t,e,n)}),t("getOwnMetadata",function(t,e,n){if(!T(e))throw new TypeError;return w(n)||(n=I(n)),_(t,e,n)}),t("getMetadataKeys",function(t,e){if(!T(t))throw new TypeError;return w(e)||(e=I(e)),m(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!T(t))throw new TypeError;return w(e)||(e=I(e)),k(t,e)}),t("deleteMetadata",function(t,e,n){if(!T(e))throw new TypeError;w(n)||(n=I(n));var r=p(e,n,!1);if(w(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=l.get(e);return i.delete(n),i.size>0||l.delete(e),!0})}(r)}()}(n||(n={}))}})}();