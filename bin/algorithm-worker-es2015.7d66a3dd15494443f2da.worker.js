!function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,(function(e){return t[e]}).bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s="DgrW")}({DgrW:function(t,e,o){"use strict";o.r(e),o.d(e,"extractInputgraph",function(){return L});var i=function(t){return t[t.unprocessed=0]="unprocessed",t[t.dangling=1]="dangling",t[t.processed=2]="processed",t}({});function n(t,e){return e.lineDegree-t.lineDegree}class s{constructor(t){this.indexMapping=new Map,this.content=[],this.comparator=t}push(t){this.content.push(t),this.indexMapping.set(t,this.content.length-1),this.siftUp(this.content.length-1)}setPosition(t,e){this.content[e]=t,this.indexMapping.set(t,e)}pop(){if(this.content.length<=1){const t=this.content.pop();return this.indexMapping.clear(),t}const t=this.content[0];return this.setPosition(this.content.pop(),0),this.siftDown(0),t}update(t){let e=this.indexMapping.get(t);this.siftUp(e)}has(t){return this.indexMapping.has(t)}size(){return this.content.length}parentIdx(t){return t-1>>1}leftIdx(t){return 1+(t<<1)}rightIdx(t){return 2+(t<<1)}siftUp(t){let e=t;for(;e>0;){const t=this.parentIdx(e);if(this.comparator(this.content[e],this.content[t])<=0)break;this.swap(e,t),e=t}}siftDown(t=0){for(;;){const e=this.leftIdx(t);if(e>=this.content.length)break;const o=this.rightIdx(t),i=o<this.content.length?this.comparator(this.content[e],this.content[o])>0?e:o:e;if(this.comparator(this.content[t],this.content[i])>=0)break;this.swap(i,t),t=i}}swap(t,e){const o=this.content[t];this.setPosition(this.content[e],t),this.setPosition(o,e)}}let r=(()=>{class t{static fixIndex(t){return t<0&&(t+=8),t%8}}return t.COST_SINK=2,t.COST_45=2,t.COST_90=1.5,t.COST_135=1,t.COST_180=0,t.TOP=0,t.TOP_RIGHT=1,t.RIGHT=2,t.BOTTOM_RIGHT=3,t.BOTTOM=4,t.BOTTOM_LEFT=5,t.LEFT=6,t.TOP_LEFT=7,t.SINK=8,t.COST_MOVE=.5,t.COST_HOP=6,t.COST_HOP_DIAGONAL=9,t.COST_CROSSING=20,t})();class a{constructor(t,e,o=0){this._edges=[],this._dist=1/0,this._priority=1/0,this._prev=this,this._gridNode=t,this._id=e,this._direction=o}get id(){return this._id}get direction(){return this._direction}get edges(){return this._edges}get gridNode(){return this._gridNode}get dist(){return this._dist}set dist(t){this._dist=t}get priority(){return this._priority}set priority(t){this._priority=t}get prev(){return this._prev}set prev(t){this._prev=t}addEdge(t){this._edges.push(t)}closeAllEdges(){this._edges.forEach(t=>t.weight=1/0)}getEdge(t){for(let e=0;e<this.edges.length;e++){let o=this.edges[e];if(o.nodeA==t||o.nodeB==t)return o}}}class d{constructor(t,e,o=0){this._used=!1,t.id<e.id?(this._nodeA=t,this._nodeB=e):(this._nodeA=e,this._nodeB=t),this._weight=o,this._originalWeight=o}get nodeA(){return this._nodeA}get nodeB(){return this._nodeB}get weight(){return this._weight}set weight(t){this._weight=t}get used(){return this._used}set used(t){this._used=t}getNeighbourOf(t){if(t.id==this._nodeA.id)return this._nodeB;if(t.id==this._nodeB.id)return this._nodeA;throw new Error("Invalid node")}resetWeight(){this.used||(this._weight=this._originalWeight)}}let h=0,u=0,c=[];function l(t,e,o){var i=performance.now();const n=o.flatMap(t=>t.getOctiNode(r.SINK));c.forEach(t=>{t.dist=1/0,t.priority=1/0,t.prev=t}),c=[];const l=new a(e[0],-1);e.map(t=>t.getOctiNode(r.SINK)).forEach(t=>l.addEdge(new d(l,t,0))),l.dist=0,l.priority=0;var _=performance.now();let y=new s(g);y.push(l);let S=0;for(u+=performance.now()-_;y.size()>0;){const t=y.pop();if(t.dist==1/0){if(S>0)return h+=performance.now()-i,f(l,n);break}if(n.includes(t)&&(S++,n.length==S))return h+=performance.now()-i,f(l,n);t.edges.forEach(e=>{const i=e.getNeighbourOf(t),n=t.dist+e.weight;n<i.dist&&(i.dist=n,i.priority=n+p(i,o),i.prev=t,y.has(i)?y.update(i):(c.push(i),y.push(i)))})}return h+=performance.now()-i,[]}function p(t,e){let o=1/0;return e.forEach(e=>{const i=function(t,e){const o=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return Math.max(o,i)}(t.gridNode,e)-1;i<o&&(o=i)}),r.COST_HOP*o}function g(t,e){return e.priority-t.priority}function f(t,e){const o=e.reduce((t,e)=>t.dist<e.dist?t:e),i=[o];let n=o;for(;n.prev!=t&&n.prev!=n;)n=n.prev,i.push(n);return i.reverse()}var _=function(t){return t[t.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",t[t.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",t[t.CLASS_TO_CLASS=2]="CLASS_TO_CLASS",t}({});const y=new class{constructor(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}addTypeMetadata(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)}addTransformMetadata(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)}addExposeMetadata(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)}addExcludeMetadata(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)}findTransformMetadatas(t,e,o){return this.findMetadatas(this._transformMetadatas,t,e).filter(t=>!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?o===_.CLASS_TO_CLASS||o===_.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||o===_.CLASS_TO_PLAIN))}findExcludeMetadata(t,e){return this.findMetadata(this._excludeMetadatas,t,e)}findExposeMetadata(t,e){return this.findMetadata(this._exposeMetadatas,t,e)}findExposeMetadataByCustomName(t,e){return this.getExposedMetadatas(t).find(t=>t.options&&t.options.name===e)}findTypeMetadata(t,e){return this.findMetadata(this._typeMetadatas,t,e)}getStrategy(t){const e=this._excludeMetadatas.get(t),o=e&&e.get(void 0),i=this._exposeMetadatas.get(t),n=i&&i.get(void 0);return o&&n||!o&&!n?"none":o?"excludeAll":"exposeAll"}getExposedMetadatas(t){return this.getMetadata(this._exposeMetadatas,t)}getExcludedMetadatas(t){return this.getMetadata(this._excludeMetadatas,t)}getExposedProperties(t,e){return this.getExposedMetadatas(t).filter(t=>!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?e===_.CLASS_TO_CLASS||e===_.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||e===_.CLASS_TO_PLAIN)).map(t=>t.propertyName)}getExcludedProperties(t,e){return this.getExcludedMetadatas(t).filter(t=>!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?e===_.CLASS_TO_CLASS||e===_.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||e===_.CLASS_TO_PLAIN)).map(t=>t.propertyName)}clear(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()}getMetadata(t,e){const o=t.get(e);let i;o&&(i=Array.from(o.values()).filter(t=>void 0!==t.propertyName));const n=[];for(const s of this.getAncestors(e)){const e=t.get(s);if(e){const t=Array.from(e.values()).filter(t=>void 0!==t.propertyName);n.push(...t)}}return n.concat(i||[])}findMetadata(t,e,o){const i=t.get(e);if(i){const t=i.get(o);if(t)return t}for(const n of this.getAncestors(e)){const e=t.get(n);if(e){const t=e.get(o);if(t)return t}}}findMetadatas(t,e,o){const i=t.get(e);let n;i&&(n=i.get(o));const s=[];for(const r of this.getAncestors(e)){const e=t.get(r);e&&e.has(o)&&s.push(...e.get(o))}return s.slice().reverse().concat((n||[]).slice().reverse())}getAncestors(t){if(!t)return[];if(!this._ancestorsMap.has(t)){const e=[];for(let o=Object.getPrototypeOf(t.prototype.constructor);void 0!==o.prototype;o=Object.getPrototypeOf(o.prototype.constructor))e.push(o);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)}};class S{constructor(t,e){this.transformationType=t,this.options=e,this.recursionStack=new Set}transform(t,e,o,i,n,s=0){if(Array.isArray(e)||e instanceof Set){const n=i&&this.transformationType===_.PLAIN_TO_CLASS?function(t){const e=new t;return e instanceof Set||"push"in e?e:[]}(i):[];return e.forEach((e,i)=>{const r=t?t[i]:void 0;if(this.options.enableCircularCheck&&this.isCircular(e))this.transformationType===_.CLASS_TO_CLASS&&(n instanceof Set?n.add(e):n.push(e));else{let t;if("function"!=typeof o&&o&&o.options&&o.options.discriminator&&o.options.discriminator.property&&o.options.discriminator.subTypes){if(this.transformationType===_.PLAIN_TO_CLASS){t=o.options.discriminator.subTypes.find(t=>t.name===e[o.options.discriminator.property]);const i=o.typeFunction({newObject:n,object:e,property:void 0});t=void 0===t?i:t.value,o.options.keepDiscriminatorProperty||delete e[o.options.discriminator.property]}this.transformationType===_.CLASS_TO_CLASS&&(t=e.constructor),this.transformationType===_.CLASS_TO_PLAIN&&(e[o.options.discriminator.property]=o.options.discriminator.subTypes.find(t=>t.value===e.constructor).name)}else t=o;const i=this.transform(r,e,t,void 0,e instanceof Map,s+1);n instanceof Set?n.add(i):n.push(i)}}),n}if(o!==String||n){if(o!==Number||n){if(o!==Boolean||n){if((o===Date||e instanceof Date)&&!n)return e instanceof Date?new Date(e.valueOf()):null==e?e:new Date(e);if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(o===Buffer||e instanceof Buffer)&&!n)return null==e?e:Buffer.from(e);if(null===(r=e)||"object"!=typeof r||"function"!=typeof r.then||n){if(n||null===e||"object"!=typeof e||"function"!=typeof e.then){if("object"==typeof e&&null!==e){o||e.constructor===Object||(o=e.constructor),!o&&t&&(o=t.constructor),this.options.enableCircularCheck&&this.recursionStack.add(e);const i=this.getKeys(o,e,n);let r=t||{};t||this.transformationType!==_.PLAIN_TO_CLASS&&this.transformationType!==_.CLASS_TO_CLASS||(r=n?new Map:o?new o:{});for(const a of i){if("__proto__"===a||"constructor"===a)continue;const i=a;let d,h=a,u=a;if(!this.options.ignoreDecorators&&o)if(this.transformationType===_.PLAIN_TO_CLASS){const t=y.findExposeMetadataByCustomName(o,a);t&&(u=t.propertyName,h=t.propertyName)}else if(this.transformationType===_.CLASS_TO_PLAIN||this.transformationType===_.CLASS_TO_CLASS){const t=y.findExposeMetadata(o,a);t&&t.options&&t.options.name&&(h=t.options.name)}d=e instanceof Map?e.get(i):e[i]instanceof Function?e[i]():e[i];let c,l=d instanceof Map;if(o&&n)c=o;else if(o){const t=y.findTypeMetadata(o,u);if(t){const o={newObject:r,object:e,property:u},n=t.typeFunction?t.typeFunction(o):t.reflectedType;t.options&&t.options.discriminator&&t.options.discriminator.property&&t.options.discriminator.subTypes?e[i]instanceof Array?c=t:(this.transformationType===_.PLAIN_TO_CLASS&&(c=t.options.discriminator.subTypes.find(e=>{if(d&&d instanceof Object&&t.options.discriminator.property in d)return e.name===d[t.options.discriminator.property]}),c=void 0===c?n:c.value,t.options.keepDiscriminatorProperty||d&&d instanceof Object&&t.options.discriminator.property in d&&delete d[t.options.discriminator.property]),this.transformationType===_.CLASS_TO_CLASS&&(c=d.constructor),this.transformationType===_.CLASS_TO_PLAIN&&(d[t.options.discriminator.property]=t.options.discriminator.subTypes.find(t=>t.value===d.constructor).name)):c=n,l=l||t.reflectedType===Map}else if(this.options.targetMaps)this.options.targetMaps.filter(t=>t.target===o&&!!t.properties[u]).forEach(t=>c=t.properties[u]);else if(this.options.enableImplicitConversion&&this.transformationType===_.PLAIN_TO_CLASS){const t=Reflect.getMetadata("design:type",o.prototype,u);t&&(c=t)}}const p=Array.isArray(e[i])?this.getReflectedType(o,u):void 0,g=t?t[i]:void 0;if(r.constructor.prototype){const t=Object.getOwnPropertyDescriptor(r.constructor.prototype,h);if((this.transformationType===_.PLAIN_TO_CLASS||this.transformationType===_.CLASS_TO_CLASS)&&(t&&!t.set||r[h]instanceof Function))continue}if(this.options.enableCircularCheck&&this.isCircular(d)){if(this.transformationType===_.CLASS_TO_CLASS){let t=d;t=this.applyCustomTransformations(t,o,a,e,this.transformationType),(void 0!==t||this.options.exposeUnsetFields)&&(r instanceof Map?r.set(h,t):r[h]=t)}}else{const t=this.transformationType===_.PLAIN_TO_CLASS?h:a;let i;this.transformationType===_.CLASS_TO_PLAIN?(i=e[t],i=this.applyCustomTransformations(i,o,t,e,this.transformationType),i=e[t]===i?d:i,i=this.transform(g,i,c,p,l,s+1)):void 0===d&&this.options.exposeDefaultValues?i=r[h]:(i=this.transform(g,d,c,p,l,s+1),i=this.applyCustomTransformations(i,o,t,e,this.transformationType)),(void 0!==i||this.options.exposeUnsetFields)&&(r instanceof Map?r.set(h,i):r[h]=i)}}return this.options.enableCircularCheck&&this.recursionStack.delete(e),r}return e}return e}return new Promise((t,i)=>{e.then(e=>t(this.transform(void 0,e,o,void 0,void 0,s+1)),i)})}return null==e?e:Boolean(e)}return null==e?e:Number(e)}return null==e?e:String(e);var r}applyCustomTransformations(t,e,o,i,n){let s=y.findTransformMetadatas(e,o,this.transformationType);return void 0!==this.options.version&&(s=s.filter(t=>!t.options||this.checkVersion(t.options.since,t.options.until))),s=s.filter(this.options.groups&&this.options.groups.length?t=>!t.options||this.checkGroups(t.options.groups):t=>!t.options||!t.options.groups||!t.options.groups.length),s.forEach(e=>{t=e.transformFn({value:t,key:o,obj:i,type:n,options:this.options})}),t}isCircular(t){return this.recursionStack.has(t)}getReflectedType(t,e){if(!t)return;const o=y.findTypeMetadata(t,e);return o?o.reflectedType:void 0}getKeys(t,e,o){let i=y.getStrategy(t);"none"===i&&(i=this.options.strategy||"exposeAll");let n=[];if(("exposeAll"===i||o)&&(n=e instanceof Map?Array.from(e.keys()):Object.keys(e)),o)return n;if(!this.options.ignoreDecorators&&t){let e=y.getExposedProperties(t,this.transformationType);this.transformationType===_.PLAIN_TO_CLASS&&(e=e.map(e=>{const o=y.findExposeMetadata(t,e);return o&&o.options&&o.options.name?o.options.name:e})),n=this.options.excludeExtraneousValues?e:n.concat(e);const o=y.getExcludedProperties(t,this.transformationType);o.length>0&&(n=n.filter(t=>!o.includes(t))),void 0!==this.options.version&&(n=n.filter(e=>{const o=y.findExposeMetadata(t,e);return!o||!o.options||this.checkVersion(o.options.since,o.options.until)})),n=n.filter(this.options.groups&&this.options.groups.length?e=>{const o=y.findExposeMetadata(t,e);return!o||!o.options||this.checkGroups(o.options.groups)}:e=>{const o=y.findExposeMetadata(t,e);return!(o&&o.options&&o.options.groups&&o.options.groups.length)})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(n=n.filter(t=>this.options.excludePrefixes.every(e=>t.substr(0,e.length)!==e))),n=n.filter((t,e,o)=>o.indexOf(t)===e),n}checkVersion(t,e){let o=!0;return o&&t&&(o=this.options.version>=t),o&&e&&(o=this.options.version<e),o}checkGroups(t){return!t||this.options.groups.some(e=>t.includes(e))}}const m={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},v=new class{classToPlain(t,e){return new S(_.CLASS_TO_PLAIN,{...m,...e}).transform(void 0,t,void 0,void 0,void 0,void 0)}classToPlainFromExist(t,e,o){return new S(_.CLASS_TO_PLAIN,{...m,...o}).transform(e,t,void 0,void 0,void 0,void 0)}plainToClass(t,e,o){return new S(_.PLAIN_TO_CLASS,{...m,...o}).transform(void 0,e,t,void 0,void 0,void 0)}plainToClassFromExist(t,e,o){return new S(_.PLAIN_TO_CLASS,{...m,...o}).transform(t,e,void 0,void 0,void 0,void 0)}classToClass(t,e){return new S(_.CLASS_TO_CLASS,{...m,...e}).transform(void 0,t,void 0,void 0,void 0,void 0)}classToClassFromExist(t,e,o){return new S(_.CLASS_TO_CLASS,{...m,...o}).transform(e,t,void 0,void 0,void 0,void 0)}serialize(t,e){return JSON.stringify(this.classToPlain(t,e))}deserialize(t,e,o){const i=JSON.parse(e);return this.plainToClass(t,i,o)}deserializeArray(t,e,o){const i=JSON.parse(e);return this.plainToClass(t,i,o)}};function N(t,e,o){return v.plainToClass(t,e,o)}class O{constructor(t,e,o){this._to=t,this._direction=e,this._edge=o}get to(){return this._to}get direction(){return this._direction}get edge(){return this._edge}}class w{constructor(t,e,o){this._routedEdges=[],this._station=void 0,this._id=t,this._x=e,this._y=o,this._octiNodes=new Array(9);for(let i=0;i<9;i++)this._octiNodes[i]=new a(this,this._id+1+i,i);for(let i=0;i<8;i++)for(let t=i+1;t<8;t++){const e=this._octiNodes[i],o=this._octiNodes[t],n=new d(e,o,this.calculateWeight(i,t));e.addEdge(n),o.addEdge(n)}for(let i=0;i<8;i++){const t=this._octiNodes[i],e=this._octiNodes[r.SINK],o=new d(t,e,r.COST_SINK);t.addEdge(o),e.addEdge(o)}}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get octiNodes(){return this._octiNodes}get routedEdges(){return this._routedEdges}get station(){return this._station}set station(t){this._station=t}getCoordinates(){return[this._x,this._y]}getOctiNode(t){return this._octiNodes[t]}closeSinkEdge(){this.getOctiNode(r.SINK).closeAllEdges()}closeBendEdges(t=1/0){for(let e=0;e<8;e++){const o=this.getOctiNode(e);for(let e=0;e<7;e++)o.edges[e].weight=t}}reopenSinkEdges(){this.getOctiNode(r.SINK).edges.filter(t=>!t.used).forEach(t=>t.weight=r.COST_SINK)}reopenBendEdges(){for(let t=0;t<8;t++){const e=this.getOctiNode(t);for(let t=0;t<7;t++)e.edges[t].resetWeight()}}saveRouting(t,e,o){this._routedEdges.push(new O(t,e,o))}removeRouting(t){this._routedEdges=this._routedEdges.filter(e=>e.edge!=t)}blockForCircularOrdering(t){if(null==this._station)return;if(this._station.adjacentNodes.size<=2)return;const e=this._station.edgeOrdering.length,o=this._station.edgeOrdering.findIndex(e=>e==t);let i=0,n=0,s=0;for(let a=o+1;a<o+e;a++){const t=this._station.edgeOrdering[a%e],o=this._routedEdges.find(e=>e.edge==t);if(null!=o){n=r.fixIndex(o.direction-s);break}s++}s=0;for(let a=o-1;a>o-e;a--){const t=this._station.edgeOrdering[(a+e)%e],o=this._routedEdges.find(e=>e.edge==t);if(null!=o){i=r.fixIndex(o.direction+s);break}s++}this.closeEdgesBetweenIndices(n,i)}closeEdgesBetweenIndices(t,e){let o=r.fixIndex(t);for(o%=8;o!=e;)this.octiNodes[r.SINK].edges[o].weight=1/0,o+=1,o=r.fixIndex(o);this.octiNodes[r.SINK].edges[o].weight=1/0}addLineBendPenalty(){this.getOctiNode(r.SINK).edges.forEach((t,e)=>{if(t.weight==1/0)return;let o=0;this._routedEdges.forEach(t=>{o+=this.calculateWeight(e,t.direction)}),t.weight=o})}calculateWeight(t,e){if(t==r.SINK||e==r.SINK)return r.COST_SINK;const o=this.calculateOctiAngle(t,e);switch(o){case 1:return r.COST_45;case 2:return r.COST_90;case 3:return r.COST_135;case 4:return r.COST_180;default:throw new Error("Invalid angle: "+o)}}calculateOctiAngle(t,e){let o=t-e;return o<-4?o+=8:o>4&&(o-=8),Math.abs(o)}}class T{constructor(t,e){this._gridNodes=[],this._width=t,this._height=e;let o=0;for(let n=0;n<t;n++){this._gridNodes[n]=[];for(let t=0;t<e;t++)this._gridNodes[n][t]=new w(o,n,t),o+=10}const i=[{x:0,y:1,portIndex:r.TOP},{x:1,y:1,portIndex:r.TOP_RIGHT},{x:1,y:0,portIndex:r.RIGHT},{x:1,y:-1,portIndex:r.BOTTOM_RIGHT}];for(let n=0;n<t;n++)for(let o=0;o<e;o++){const s=this._gridNodes[n][o];for(let a of i){const i=n+a.x,h=o+a.y;if(i<0||i>=t)continue;if(h<0||h>=e)continue;const u=s.getOctiNode(a.portIndex),c=this._gridNodes[i][h].getOctiNode(a.portIndex+4),l=Math.abs(a.x)+Math.abs(a.y)==2,p=new d(u,c,l?r.COST_HOP_DIAGONAL:r.COST_HOP);u.addEdge(p),c.addEdge(p)}}}get gridNodes(){return this._gridNodes}get allNodes(){return this.gridNodes.flatMap(t=>t.flatMap(t=>t.octiNodes))}get width(){return this._width}get height(){return this._height}hasNode(t,e){return!(t<0||t>=this._width||e<0||e>=this._height)}getNode(t,e){return this._gridNodes[t][e]}getDiagonal(t){let e=t.nodeA,o=t.nodeB;if(e.gridNode==o.gridNode)return;let[i,n]=e.gridNode.getCoordinates(),[s,r]=o.gridNode.getCoordinates();if(1==Math.abs(i-s)&&1==Math.abs(n-r)){let t,e,o=this.getNode(i,r),a=this.getNode(s,n),[d,h]=o.getCoordinates(),[u,c]=a.getCoordinates();return d>u&&h>c?(t=o.getOctiNode(5),e=a.getOctiNode(1)):d<u&&h<c?(t=o.getOctiNode(1),e=a.getOctiNode(5)):d<u&&c<h?(t=o.getOctiNode(3),e=a.getOctiNode(7)):(t=o.getOctiNode(7),e=a.getOctiNode(3)),t.getEdge(e)}}closeDiagonalEdge(t,e){const o=this.getDiagonal(t);null!=o&&(o.weight=e?r.COST_CROSSING:1/0)}}class I{constructor(t=0,e=0){this.x=t,this.y=e}}class E{constructor(){this._latitude=0,this._longitude=0,this._stationName="",this._stopID="",this._lineDegree=0,this._status=i.unprocessed,this._adjacentNodes=new Set,this._edgeOrdering=[]}get latitude(){return this._latitude}set latitude(t){this._latitude=t}get longitude(){return this._longitude}set longitude(t){this._longitude=t}get stationName(){return this._stationName}set stationName(t){this._stationName=t}get stopID(){return this._stopID}set stopID(t){this._stopID=t}get lineDegree(){return this._lineDegree}set lineDegree(t){this._lineDegree=t}get status(){return this._status}set status(t){this._status=t}get adjacentNodes(){return this._adjacentNodes}set adjacentNodes(t){this._adjacentNodes=t}get edgeOrdering(){return this._edgeOrdering}raiseLineDegreeBy(t){this._lineDegree+=t}calculateEdgeOrdering(t,e){let o=[0,1];this._edgeOrdering=Array.from(t.values()).map(t=>{const e=t.otherStation(this);return{adjacentNode:e,angle:function(t,e){let o=-1*(Math.atan2(e[1],e[0])-Math.atan2(t[1],t[0]))*(180/Math.PI);return o<0&&(o=360+o),o}(o,[e.latitude-this.latitude,e.longitude-this.longitude]),adjacentEdge:t}}).sort((t,e)=>e.angle-t.angle).map(t=>t.adjacentEdge)}replaceStation(t,e,o){let i=Array.from(this.adjacentNodes);for(let n=0;n<this.adjacentNodes.size;n++)if(i[n].stopID==t){i[n]=e;break}for(let n=0;n<this._edgeOrdering.length;n++)if(this._edgeOrdering[n].otherStation(this).stopID==t){this._edgeOrdering[n]=o;break}this.adjacentNodes=new Set(i)}}class M{constructor(t,e,o,i,n){this._line=[],this._inBetweenStations=[],this._color=[],this._routeType="",this._line.push(t),this._station1=e,this._station2=o,this._color.push(null==i||i.length<6?"#000000":i),this._routeType=n}get station1(){return this._station1}set station1(t){this._station1=t}get station2(){return this._station2}set station2(t){this._station2=t}get line(){return this._line}get inBetweenStations(){return this._inBetweenStations}set inBetweenStations(t){this._inBetweenStations=t}get color(){return this._color}set color(t){this._color=t}get routeType(){return this._routeType}getLineDegree(){return this._line.length}equalsByStation(t){return this.station2.stopID==t.station2.stopID&&this.station1.stopID==t.station1.stopID||this.station1.stopID==t.station2.stopID&&this.station2.stopID==t.station1.stopID}addLine(t,e){this._line.push(...t),this._color.push(...e)}otherStation(t){return this.station1==t?this.station2:this.station1}}function A(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r}function x(t,e={}){return function(o,i){const n=Reflect.getMetadata("design:type",o,i);y.addTypeMetadata({target:o.constructor,propertyName:i,reflectedType:n,typeFunction:t,options:e})}}o("mNvP");let C=(()=>{class t{constructor(){this._nodes=[],this._edges=[]}get nodes(){return this._nodes}set nodes(t){this._nodes=t}get edges(){return this._edges}set edges(t){this._edges=t}getMinCoordinates(){let t=1/0,e=1/0;return this.nodes.forEach(o=>{o.longitude<t&&(t=o.longitude),o.latitude<e&&(e=o.latitude)}),[t,e]}getDimensions(){let t=1/0,e=1/0,o=-1/0,i=-1/0;return this.nodes.forEach(n=>{n.longitude<t&&(t=n.longitude),n.longitude>o&&(o=n.longitude),n.latitude<e&&(e=n.latitude),n.latitude>i&&(i=n.latitude)}),[o-t,i-e]}getNodesByStatus(t){return this.nodes.filter(e=>e.status==t)}getNodeIDsByStatus(t){return this.getNodesByStatus(t).map(t=>t.stopID)}getNodeByID(t){return this._nodes.find(e=>e.stopID==t)}getAllNotProcessedNodesIDs(){return this.getNodeIDsByStatus(i.unprocessed).concat(this.getNodeIDsByStatus(i.dangling))}setNodeAsProcessed(t){let e=this.getNodeByID(t);null!=e&&(e.status=i.processed)}calculateNodeLineDegrees(){this.edges.forEach(t=>{let e=t.station1.stopID,o=t.station2.stopID,i=this.nodes.find(t=>t.stopID==e);void 0!==i&&i.raiseLineDegreeBy(t.getLineDegree()),i=this.nodes.find(t=>t.stopID==o),void 0!==i&&i.raiseLineDegreeBy(t.getLineDegree())})}getDanglingNodeWithHighestDegree(){let t=-1,e=-1,o=this.getNodesByStatus(i.dangling);for(let i=0;i<o.length;i++){let n=this.getNodeByID(o[i].stopID);void 0!==n&&n.lineDegree>t&&(t=n.lineDegree,e=i)}return o[e].stopID}getIncidentEdges(t){let e=[];return this.edges.forEach(o=>{o.station2.stopID!==t&&o.station1.stopID!==t||e.push(o)}),e}getAdjacentNodes(t){let e=[];return this.edges.forEach(o=>{o.station2.stopID===t?e.push(o.station1.stopID):o.station1.stopID===t&&e.push(o.station2.stopID)}),this.nodes.filter(t=>-1!=e.indexOf(t.stopID))}calculateEdgeOrderingAtNode(){this.nodes.forEach(t=>{let e=new Set,o=new Set;this.edges.forEach(i=>{i.station1.stopID==t.stopID?(e.add(i),o.add(this.getNodeByID(i.station2.stopID))):i.station2.stopID==t.stopID&&(e.add(i),o.add(this.getNodeByID(i.station1.stopID)))}),0!=o.size&&0!=e.size&&(t.calculateEdgeOrdering(e,o),t.adjacentNodes=o)})}removeTwoDegreeNodes(){for(let t=0;t<this.nodes.length;t++){let e=this.nodes[t];if(2==e.adjacentNodes.size){let t,o=Array.from(e.adjacentNodes),i=!1;for(let n=0;n<this.edges.length;n++){let s=this.edges[n];if(i||s.station2.stopID!=e.stopID&&s.station1.stopID!=e.stopID||(t=s,s.station2.stopID==e.stopID?(s.inBetweenStations.push(s.station2),s.station2=s.station1.stopID==o[0].stopID?o[1]:o[0]):(s.inBetweenStations.push(s.station1),s.station1=s.station2.stopID==o[0].stopID?o[1]:o[0]),o[0].replaceStation(e.stopID,o[1],t),o[1].replaceStation(e.stopID,o[0],t),i=!0),(s.station1.stopID==e.stopID||s.station2.stopID==e.stopID)&&i){t.inBetweenStations.push(...this.edges[n].inBetweenStations),this.edges.splice(n,1);break}}}}}removeNodesWithoutEdges(){for(let t=0;t<this.nodes.length;t++)0==this.nodes[t].adjacentNodes.size&&(this.nodes.splice(t,1),t--)}mergeEqualEdges(){let t=[];for(let e=0;e<this._edges.length;e++){let o=this._edges[e],i=this.containsEdge(t,o);null!=i?i.addLine(o.line,o.color):t.push(o)}this._edges=t}containsEdge(t,e){for(let o=0;o<t.length;o++)if(t[o].equalsByStation(e))return t[o]}}return A([x(()=>E)],t.prototype,"_nodes",void 0),A([x(()=>M)],t.prototype,"_edges",void 0),t})();class D{constructor(t,e,o,i){this._inBetweenStations=[],this._points=t,this._lines=e,this._inBetweenStations=null==o?void 0:o.map(t=>t.stationName),this._color=i}get points(){return this._points}get lines(){return this._lines}get inBetweenStations(){return this._inBetweenStations}get colors(){return this._color}}class b{constructor(t,e){this._position=t,this._name=e}get position(){return this._position}get name(){return this._name}}let P=(()=>{class t{constructor(t,e,o,i){this._paths=[],this._width=t,this._height=e,this._paths=i,this._stations=o}get width(){return this._width}get height(){return this._height}get stations(){return this._stations}get paths(){return this._paths}}return A([x(()=>b)],t.prototype,"_stations",void 0),A([x(()=>D)],t.prototype,"_paths",void 0),t})();function L(t){let e=N(C,t);return e.nodes=e.nodes.map(t=>N(E,t)),e.edges=e.edges.map(t=>N(M,t)),e.edges.forEach(t=>{const o=t.station2._stopID;t.station2=e.getNodeByID(t.station1._stopID),t.station1=e.getNodeByID(o)}),e}addEventListener("message",({data:t})=>{if(null==t.graph)return;console.log("[algorithm-worker] preparing");let e=L(t.graph),o=new k(e,t);console.log("[algorithm-worker] starting algorithm");const s=o.performAlgorithm(function(t){t.nodes.sort(n);let e=[];return t.getNodesByStatus(i.unprocessed).forEach(o=>{o.status=i.dangling;let s=t.getNodesByStatus(i.dangling);for(;0!=s.length;){let o=t.getDanglingNodeWithHighestDegree(),r=t.getIncidentEdges(o),a=t.getAdjacentNodes(o);a.sort(n);let d=[];for(;0!=a.length;){let e=a[0];if(-1!==t.getAllNotProcessedNodesIDs().indexOf(e.stopID))for(let t=0;t<r.length;t++){let o=r[t];o.station1.stopID!=e.stopID&&o.station2.stopID!=e.stopID||(d.push(o),r.splice(t,1),t--)}a.shift()}t.setNodeAsProcessed(o),e=e.concat(d),s=t.getNodesByStatus(i.dangling)}}),e}(e));console.log("[algorithm-worker] creating output graph"),console.log("[algorithm-worker] finished"),postMessage(s)});class k{constructor(t,e){this._ignoreError=!0,this._settledStations=new Map,this._foundPaths=new Map,this.allowCrossing=!1,this.exactString=[],this.exactString=e.exactString,this.allowCrossing=e.allowCrossing,(t=this.filterInputGraph(t)).mergeEqualEdges(),t.calculateNodeLineDegrees(),t.calculateEdgeOrderingAtNode(),t.removeNodesWithoutEdges(),this.D=function(t){let e=0;return t.edges.forEach(t=>{e+=function(t,e){let o=Math.pow(t.latitude-e.latitude,2),i=Math.pow(t.longitude-e.longitude,2);return Math.sqrt(o+i)}(t.station1,t.station2)}),e/t.edges.length}(t)*parseFloat(e.r),t.removeTwoDegreeNodes(),t.calculateEdgeOrderingAtNode(),this.r=2,this._inputGraph=t;let o=t.getDimensions();this._graphOffset=t.getMinCoordinates(),this._octiGraph=new T(o[0]/this.D,o[1]/this.D)}performAlgorithm(t){return this._foundPaths.clear(),this._settledStations.clear(),t.forEach(t=>{const e=t.station1,o=t.station2,i=this.getCandidateNodes(e,o),n=i[0],s=i[1];this.isSettled(n)&&(n[0].blockForCircularOrdering(t),n[0].addLineBendPenalty()),this.isSettled(s)&&(s[0].blockForCircularOrdering(t),s[0].addLineBendPenalty());let r=l(0,n,s);if(0==r.length&&this._ignoreError)console.log(`[algorithm-worker] No path found for edge: (${e.stationName} - ${o.stationName})`);else{if(0==r.length)throw new Error(`No path found for edge: (${e.stationName} - ${o.stationName})`);this.storePath(r,t,e,o)}}),console.log("Total time in dijkstra:",h,"section time:",u),console.log("[algorithm-worker] starting local search"),h=0,u=0,Array.from(this._settledStations.keys()).forEach(t=>{this.performLocalSearch(t)}),console.log("Total time in dijkstra:",h,"section time:",u),console.log(`Found ${this._foundPaths.size} of ${this._inputGraph.edges.length}`),this._inputGraph.edges.forEach(t=>{this._foundPaths.has(t)||console.log("Did not find ",t)}),this.createOutputGraph()}isSettled(t){return 1==t.length&&Array.from(this._settledStations.values()).includes(t[0])}getCandidateNodes(t,e){const o=this.getGrapCoordinates(t),i=this.getGrapCoordinates(e);let n=[],s=[];for(let a=-this.r-1;a<=this.r+1;a++)for(let t=-this.r-1;t<=this.r+1;t++)for(let e of[o,i]){const d=Math.round(e.x+a),h=Math.round(e.y+t);if(!this._octiGraph.hasNode(d,h))break;const u=this._octiGraph.getNode(d,h);if(n.includes(u)||s.includes(u))continue;if(Array.from(this._settledStations.values()).includes(u))continue;if(this.nodeIsUsed(u))continue;const c=Math.sqrt((o.x-d)*(o.x-d)+(o.y-h)*(o.y-h)),l=Math.sqrt((i.x-d)*(i.x-d)+(i.y-h)*(i.y-h));if(c<=this.r||l<=this.r)if(c<l){const t=c*(r.COST_MOVE+r.COST_HOP);u.getOctiNode(r.SINK).edges.forEach(e=>e.weight=r.COST_SINK+t),n.push(u)}else{const t=l*(r.COST_MOVE+r.COST_HOP);u.getOctiNode(r.SINK).edges.forEach(e=>e.weight=r.COST_SINK+t),s.push(u)}}if(this._settledStations.has(t)){let e=this._settledStations.get(t);e.reopenSinkEdges(),n=[e]}if(this._settledStations.has(e)){let t=this._settledStations.get(e);t.reopenSinkEdges(),s=[t]}return[n,s]}nodeIsUsed(t){return t.octiNodes.flatMap(t=>t.edges).some(t=>t.used)}filterInputGraph(t){return 0!=this.exactString.length&&(t.edges=t.edges.filter(t=>this.exactString.some(e=>e===t.line[0]))),t}storePath(t,e,o,i){this._foundPaths.set(e,t),this._settledStations.set(o,t[0].gridNode),this._settledStations.set(i,t[t.length-1].gridNode),t[0].gridNode.station=o,t[t.length-1].gridNode.station=i,t[0].gridNode.saveRouting(i,t[1].direction,e),t[t.length-1].gridNode.saveRouting(o,t[t.length-2].direction,e),t.map(t=>t.gridNode).forEach(t=>{t.closeSinkEdge(),t.closeBendEdges(this.allowCrossing?r.COST_CROSSING:1/0)});for(let n=0;n<t.length-1;n++){let e=t[n].getEdge(t[n+1]);null!=e&&(e.used=!0,e.weight=1/0,this._octiGraph.closeDiagonalEdge(e,this.allowCrossing))}}performLocalSearch(t){const e=this._settledStations.get(t),o=[];for(let n=-1;n<=1;n++)for(let i=-1;i<=1;i++){if(!this._octiGraph.hasNode(e.x+n,e.y+i))continue;const s=this._octiGraph.getNode(e.x+n,e.y+i);if(null!=s.station)continue;if(this.removeAllRoutingsTo(t),this.nodeIsUsed(s))continue;const r=this.routeAllStationEdges(t,s);r.x=n,r.y=i,o.push(r)}if(this.removeAllRoutingsTo(t),0==o.length)return void console.log(`[algorithm-worker] Local search failed for: ${t.stationName}`);const i=o.reduce((t,e)=>t.found.size>e.found.size?t:t.found.size<e.found.size?e:t.cost<e.cost?t:e);i.found.size<t.edgeOrdering.length&&console.log(`[algorithm-worker] Local search missing ${t.edgeOrdering.length-i.found.size} edges for: ${t.stationName}`),i.found.forEach((e,o)=>this.storePath(e,o,t,o.otherStation(t)))}removeAllRoutingsTo(t){t.edgeOrdering.forEach(e=>{const o=this._foundPaths.get(e);null!=o&&(this.reopenPath(o),o.slice(2,o.length-3).forEach(t=>{t.gridNode.reopenSinkEdges(),t.gridNode.reopenBendEdges()}),o[0].gridNode.removeRouting(e),o[o.length-1].gridNode.removeRouting(e),o[0].gridNode.station==t&&(o[0].gridNode.station=void 0,o[0].gridNode.closeBendEdges(),o[0].gridNode.reopenSinkEdges()),o[o.length-1].gridNode.station==t&&(o[o.length-1].gridNode.station=void 0,o[o.length-1].gridNode.reopenBendEdges(),o[o.length-1].gridNode.reopenSinkEdges()),this._foundPaths.delete(e))}),this._settledStations.delete(t)}routeAllStationEdges(t,e){let o=0;const i=new Map;return t.edgeOrdering.forEach(n=>{const s=n.otherStation(t);if(!this._settledStations.has(s))return;const r=this._settledStations.get(s),a=this.routePath(e,r,t,s,n);0!=a.length&&(o+=a[a.length-1].dist,i.set(n,a))}),{cost:o,found:i,x:0,y:0}}routePath(t,e,o,i,n){t.reopenSinkEdges(),t.blockForCircularOrdering(n),t.addLineBendPenalty(),e.reopenSinkEdges(),e.blockForCircularOrdering(n),e.addLineBendPenalty();const s=l(0,[t],[e]);return 0==s.length?[]:(this.storePath(s,n,o,i),s)}reopenPath(t){for(let e=0;e<t.length-1;e++){let o=t[e].getEdge(t[e+1]);if(null!=o){o.used=!1,o.resetWeight();const t=this._octiGraph.getDiagonal(o);null!=t&&t.resetWeight()}}}getGrapCoordinates(t){return new I((t.longitude-this._graphOffset[0])/this.D,(t.latitude-this._graphOffset[1])/this.D)}createOutputGraph(){const t=[];this._settledStations.forEach((e,o)=>{t.push(new b(new I(e.x,e.y),o.stationName))});const e=[];return this._foundPaths.forEach((t,o)=>{const i=[...new Set(t.map(t=>t.gridNode))],n=i.map(t=>new I(t.x,t.y));let s=o.station1;o.inBetweenStations=o.inBetweenStations.sort((t,e)=>{let n=this.euclideanDistance([s.latitude,s.longitude],[t.latitude,t.longitude]),r=this.euclideanDistance([s.latitude,s.longitude],[e.latitude,e.longitude]);return i[0].station==o.station2?r-n:n-r}),e.push(new D(n,o.line,o.inBetweenStations,o.color))}),new P(this._octiGraph.width,this._octiGraph.height,t,e)}euclideanDistance(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}}},mNvP:function(t,e){var o;!function(t){!function(e){var o="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=n(t);function n(t,e){return function(o,i){"function"!=typeof t[o]&&Object.defineProperty(t,o,{configurable:!0,writable:!0,value:i}),e&&e(o,i)}}void 0===o.Reflect?o.Reflect=t:i=n(o.Reflect,i),function(t){var e=Object.prototype.hasOwnProperty,o="function"==typeof Symbol,i=o&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=o&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,r={__proto__:[]}instanceof Array,a=!s&&!r,d={create:s?function(){return L(Object.create(null))}:r?function(){return L({__proto__:null})}:function(){return L({})},has:a?function(t,o){return e.call(t,o)}:function(t,e){return e in t},get:a?function(t,o){return e.call(t,o)?t[o]:void 0}:function(t,e){return t[e]}},h=Object.getPrototypeOf(Function),u="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,c=u||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],o=function(){function t(t,e,o){this._index=0,this._keys=t,this._values=e,this._selector=o}return t.prototype["@@iterator"]=function(){return this},t.prototype[n]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var o=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:o,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var o=this._find(t,!0);return this._values[o]=e,this},e.prototype.delete=function(e){var o=this._find(e,!1);if(o>=0){for(var i=this._keys.length,n=o+1;n<i;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new o(this._keys,this._values,i)},e.prototype.values=function(){return new o(this._keys,this._values,s)},e.prototype.entries=function(){return new o(this._keys,this._values,r)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[n]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function i(t,e){return t}function s(t,e){return e}function r(t,e){return[t,e]}}():Map,l=u||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new c}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[n]=function(){return this.keys()},t}():Set,p=new(u||"function"!=typeof WeakMap?function(){var t=d.create(),o=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=n(t,!1);return void 0!==e&&d.has(e,this._key)},t.prototype.get=function(t){var e=n(t,!1);return void 0!==e?d.get(e,this._key):void 0},t.prototype.set=function(t,e){return n(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=n(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var e;do{e="@@WeakMap@@"+r()}while(d.has(t,e));return t[e]=!0,e}function n(t,i){if(!e.call(t,o)){if(!i)return;Object.defineProperty(t,o,{value:d.create()})}return t[o]}function s(t,e){for(var o=0;o<e;++o)t[o]=255*Math.random()|0;return t}function r(){var t=(16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(16)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(16)):s(new Uint8Array(16),16):s(new Array(16),16));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var e="",o=0;o<16;++o){var i=t[o];4!==o&&6!==o&&8!==o||(e+="-"),i<16&&(e+="0"),e+=i.toString(16).toLowerCase()}return e}}():WeakMap);function g(t,e,o){var i=p.get(t);if(w(i)){if(!o)return;i=new c,p.set(t,i)}var n=i.get(e);if(w(n)){if(!o)return;n=new c,i.set(e,n)}return n}function f(t,e,o){if(_(t,e,o))return!0;var i=P(e);return!T(i)&&f(t,i,o)}function _(t,e,o){var i=g(e,o,!1);return!w(i)&&!!i.has(t)}function y(t,e,o){if(_(t,e,o))return S(t,e,o);var i=P(e);return T(i)?void 0:y(t,i,o)}function S(t,e,o){var i=g(e,o,!1);if(!w(i))return i.get(t)}function m(t,e,o,i){g(o,i,!0).set(t,e)}function v(t,e){var o=N(t,e),i=P(t);if(null===i)return o;var n=v(i,e);if(n.length<=0)return o;if(o.length<=0)return n;for(var s=new l,r=[],a=0,d=o;a<d.length;a++)s.has(c=d[a])||(s.add(c),r.push(c));for(var h=0,u=n;h<u.length;h++){var c;s.has(c=u[h])||(s.add(c),r.push(c))}return r}function N(t,e){var o=[],i=g(t,e,!1);if(w(i))return o;for(var s=function(t){var e=C(t,n);if(!A(e))throw new TypeError;var o=e.call(t);if(!I(o))throw new TypeError;return o}(i.keys()),r=0;;){var a=D(s);if(!a)return o.length=r,o;var d=a.value;try{o[r]=d}catch(h){try{b(s)}finally{throw h}}r++}}function O(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function T(t){return null===t}function I(t){return"object"==typeof t?null!==t:"function"==typeof t}function E(t){var e=function(t,e){switch(O(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var o=3===e?"string":5===e?"number":"default",n=C(t,i);if(void 0!==n){var s=n.call(t,o);if(I(s))throw new TypeError;return s}return function(t,e){if("string"===e){var o=t.toString;if(A(o)&&!I(n=o.call(t)))return n;if(A(i=t.valueOf)&&!I(n=i.call(t)))return n}else{var i;if(A(i=t.valueOf)&&!I(n=i.call(t)))return n;var n,s=t.toString;if(A(s)&&!I(n=s.call(t)))return n}throw new TypeError}(t,"default"===o?"number":o)}(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function M(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function A(t){return"function"==typeof t}function x(t){return"function"==typeof t}function C(t,e){var o=t[e];if(null!=o){if(!A(o))throw new TypeError;return o}}function D(t){var e=t.next();return!e.done&&e}function b(t){var e=t.return;e&&e.call(t)}function P(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===h)return e;if(e!==h)return e;var o=t.prototype,i=o&&Object.getPrototypeOf(o);if(null==i||i===Object.prototype)return e;var n=i.constructor;return"function"!=typeof n||n===t?e:n}function L(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,o,i){if(w(o)){if(!M(t))throw new TypeError;if(!x(e))throw new TypeError;return function(t,e){for(var o=t.length-1;o>=0;--o){var i=(0,t[o])(e);if(!w(i)&&!T(i)){if(!x(i))throw new TypeError;e=i}}return e}(t,e)}if(!M(t))throw new TypeError;if(!I(e))throw new TypeError;if(!I(i)&&!w(i)&&!T(i))throw new TypeError;return T(i)&&(i=void 0),function(t,e,o,i){for(var n=t.length-1;n>=0;--n){var s=(0,t[n])(e,o,i);if(!w(s)&&!T(s)){if(!I(s))throw new TypeError;i=s}}return i}(t,e,o=E(o),i)}),t("metadata",function(t,e){return function(o,i){if(!I(o))throw new TypeError;if(!w(i)&&!function(t){switch(O(t)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;m(t,e,o,i)}}),t("defineMetadata",function(t,e,o,i){if(!I(o))throw new TypeError;return w(i)||(i=E(i)),m(t,e,o,i)}),t("hasMetadata",function(t,e,o){if(!I(e))throw new TypeError;return w(o)||(o=E(o)),f(t,e,o)}),t("hasOwnMetadata",function(t,e,o){if(!I(e))throw new TypeError;return w(o)||(o=E(o)),_(t,e,o)}),t("getMetadata",function(t,e,o){if(!I(e))throw new TypeError;return w(o)||(o=E(o)),y(t,e,o)}),t("getOwnMetadata",function(t,e,o){if(!I(e))throw new TypeError;return w(o)||(o=E(o)),S(t,e,o)}),t("getMetadataKeys",function(t,e){if(!I(t))throw new TypeError;return w(e)||(e=E(e)),v(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!I(t))throw new TypeError;return w(e)||(e=E(e)),N(t,e)}),t("deleteMetadata",function(t,e,o){if(!I(e))throw new TypeError;w(o)||(o=E(o));var i=g(e,o,!1);if(w(i))return!1;if(!i.delete(t))return!1;if(i.size>0)return!0;var n=p.get(e);return n.delete(o),n.size>0||p.delete(e),!0})}(i)}()}(o||(o={}))}});